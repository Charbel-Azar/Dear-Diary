<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Tell Stories That Matter" />
  <meta name="author" content="Dear Diary">
  <link rel="icon" type="image/ico" href="./assests/images/camera/favicon.ico" />
  <link rel="stylesheet" href="./assests/css/style2.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ms+Madi&family=Syne:wght@400..800&display=swap" rel="stylesheet">
  <title>Dear Diary</title>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="logo">
        <a href="index.html">
          <img src="./assests/images/logo/white_transparent_logo.png" alt="Dear Diary Logo">
        </a>
      </div>
      
      <div class="nav-links">
     <a href="ourstory.html">Our Story</a>
    <a href="ourwork.html">Our Work</a>
    <a href="offers.html">Offers</a>
    <a href="careers.html">Careers</a>
      </div>
     <div class="social-links">
        <a href="https://www.instagram.com/deardiary.media" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://www.facebook.com/people/Dear-Diary-Media/61572525600344/" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
       <a href="https://www.linkedin.com/company/dear-diary-media/" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
        <a href="https://www.tiktok.com/@deardiary.media" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>    
      </div>

    <button class="mobile-menu-btn" aria-label="Toggle menu">
      <div class="menu-circle">
        <div class="menu-bar"></div>
        <div class="menu-bar"></div>
        <div class="menu-bar"></div>
      </div>
    </button>
  </div>
</nav>

<!-- Mobile Menu -->
<div class="mobile-menu">
  <div class="mobile-menu-links">
    <a href="ourstory.html">Our Story</a>
    <a href="ourwork.html">Our Work</a>
    <a href="offers.html">Offers</a>
    <a href="careers.html">Careers</a>
  </div>
   <div class="mobile-social-links">
    <a href="https://www.instagram.com/deardiary.media" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
    <a href="https://www.facebook.com/people/Dear-Diary-Media/61572525600344/" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
    <a href="https://www.linkedin.com/company/dear-diary-media/" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
    <a href="https://www.tiktok.com/@deardiary.media" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
  </div>
</div>

  <!-- LOADING SCREEN -->
<!-- LOADING SCREEN -->
<section id="loading-screen" class="loading-screen-section">
  <div class="containercamera">
    <video class="videocamera" autoplay muted loop playsinline>
      <source src="./assests/images/camera/loading (4).mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
  <div class="flash"></div>
  <div class="wave-text">
  <span style="--i: 0;">C</span>
  <span style="--i: 1;">l</span>
  <span style="--i: 2;">i</span>
  <span style="--i: 3;">c</span>
  <span style="--i: 4;">k</span>
  <span style="--i: 5;">&nbsp;</span>
  <span style="--i: 6;">t</span>
  <span style="--i: 7;">o</span>
  <span style="--i: 8;">&nbsp;</span>
  <span style="--i: 9;">t</span>
  <span style="--i: 10;">a</span>
  <span style="--i: 11;">k</span>
  <span style="--i: 12;">e</span>
  <span style="--i: 13;">&nbsp;</span>
  <span style="--i: 14;">a</span>
  <span style="--i: 15;">&nbsp;</span>
  <span style="--i: 16;">p</span>
  <span style="--i: 17;">i</span>
  <span style="--i: 18;">c</span>
  <span style="--i: 19;">t</span>
  <span style="--i: 20;">u</span>
  <span style="--i: 21;">r</span>
  <span style="--i: 22;">e</span>
</div>

  <button id="skip-button" class="skip-button">Skip</button>
</section>

  <!-- MAIN WEBSITE CONTENT -->
  <main id="main-content" class="main-content-section">
    <!-- Hero Video Section -->
    <section class="hero-video-section">
      <div class="video-container">
        <video 
          class="hero-video" 
          data-autoplay 
          data-src="./assests/images/camera/intro.mp4"
          muted 
          loop 
          playsinline 
          preload="none"
        >
        </video>

      </div>
    </section>



    <!-- Story Section -->
    <section class="story-section">
      <div class="story-container">
        <h1 class="story-heading">Once Upon a Time</h1>
        <!-- This div controls the scroll height -->
        <div id="video-scroll-height"></div>
        <!-- Video container -->
        <div class="video-container">
          <video id="scroll-video" muted preload="auto">
            <source src="./assests/images/book/diary.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
    </section>
    

     

    </section>
  
<section>
  <div class="slogan">
    
    Tell Stories  <br><span class="neon-text">That Matter</span>
  </div>
</section>

<section class="video-expand-section">
  <div class="video-wrapper">
    <video 
        class="expanding-video"
        data-autoplay 
        data-src="./assests/images/camera/intro.mp4"
        muted 
        loop 
        playsinline
        preload="none"
      ></video>

  </div>
</section>

<section class="secret-section">
  <div class="secret-slogan">
    Tell Us Your <br><span class="neon-text">Dirty</span> <br>Little Secret
  </div>
  
  <div class="videosecret-container">
    <!-- 
      Autoplay, loop, muted, and playsinline ensure 
      it loops silently without user interaction. 
    -->
    <video
      class="secret-video"
      autoplay 
      loop 
      muted 
      playsinline
    >
      <source src="./assests/images/secrets/secrets.mp4" type="video/mp4">
    </video>

  </div>
  <p class="secret-text">We're here to tell your untold story!</p>
  
  <div class="keys-container">
    <p class="keys-text"> Tell us your secrets and throw away the key</p>
    <div class="floating-keys">
      <!-- Each key starts with the glow-breathing class -->
      <div class="flying-key glow-breathing"><i class="fas fa-key"></i></div>
      <div class="flying-key glow-breathing"><i class="fas fa-key"></i></div>
      <div class="flying-key glow-breathing"><i class="fas fa-key"></i></div>
      <div class="flying-key glow-breathing"><i class="fas fa-key"></i></div>
    </div>

    <!-- The "Reset" text/button: -->
    <p class="reset-text">Reset Keys</p>
  </div>
  

  <div style="text-align: center; font: size 2vh;">
    <a href="https://wa.me/96171293786?text=Hey%21" target="_blank" class="cta-button" style="margin-bottom: 5vh;">Let's Grab a Virtual Coffee?</a>
</div>
</section>

<section class="video-cube">
  <div class="slogan" style="margin-top: 0.5vh;">
    Stories We Have Told
  </div>
  <p class="keys-text mobile-only">Pst press any cube...</p>

  <!-- A wrapper that keeps the grid a square -->
  <div class="video-grid">
    <!-- Cells will be injected by JavaScript -->
  </div>
</section>


<section class="comparison-section" id="fairySection">
  <div class="sloganslide">
    It isn't Magic, Just Good Storytelling
  </div>
  <div class="comparison-container">
    <!-- First Comparison -->
    <div class="image-container">
      <div class="comparison-wrapper">
          <video 
            data-autoplay 
            data-src="./assests/images/beforeafter/After1.mp4" 
            alt="After Video 1" 
            class="after-video" 
            muted 
            loop 
            preload="none">
          </video>
          <video 
            data-autoplay 
            data-src="./assests/images/beforeafter/Before1.mp4" 
            alt="Before Video 1" 
            class="before-video" 
            muted 
            loop 
            preload="none">
          </video>
          <div class="slider">
              <div class="slider-button"></div>
          </div>
      </div>
      <div class="neon-textslide">Now thats better!</div>
    </div>

    <!-- Second Comparison -->
    <div class="image-container">
      <div class="comparison-wrapper">
          <video 
            data-autoplay 
            data-src="./assests/images/beforeafter/After2.mp4" 
            alt="After Video 2" 
            class="after-video" 
            muted 
            loop 
            preload="none">
          </video>
          <video 
            data-autoplay 
            data-src="./assests/images/beforeafter/Before2.mp4" 
            alt="Before Video 2" 
            class="before-video" 
            muted 
            loop 
            preload="none">
          </video>
          <div class="slider">
              <div class="slider-button"></div>
          </div>
      </div>
      <div class="neon-textslide">Our Kind of Transformation!</div>
    </div>

    <!-- Third Comparison -->
    <div class="image-container">
      <div class="comparison-wrapper">
          <video 
            data-autoplay 
            data-src="./assests/images/beforeafter/after3.mp4" 
            alt="After Video 3" 
            class="after-video" 
            muted 
            loop 
            preload="none">
          </video>
          <video 
            data-autoplay 
            data-src="./assests/images/beforeafter/before3.mp4" 
            alt="Before Video 3" 
            class="before-video" 
            muted 
            loop 
            preload="none">
          </video>
          <div class="slider">
              <div class="slider-button"></div>
          </div>
      </div>
      <div class="neon-textslide">That's How The Story Goes!</div>
    </div>
  </div>
  <canvas id="fairyCanvas"></canvas>
</section>





<section class="testimonials-section">
  <div class="sloganslide" style="margin-bottom: 3vh;">
    Letters From Our Admirers
   <p class="keys-text">Swipe Away...</p>
</div>

  <div class="slidere-container">
    <div class="slidere">
      <div class="slidere-track">
        <!-- Testimonial 1 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Never knew this was what was missing for my brand. I'm so thankful for you guys!"</p>
            <p class="author">- Jenny R</p>
          </div>
        </div>
        <!-- Testimonial 2 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"My brand has come such a long way with your help. Thank you!"</p>
            <p class="author">- Joanna F</p>
          </div>
        </div>
        <!-- Testimonial 3 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"I never really had the time to work on digital marketing for my brand. you made it look so easy."</p>
            <p class="author">- Mariam M</p>
          </div>
        </div>
        <!-- Testimonial 4 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"you guys really took my business to the next level."</p>
            <p class="author">- Saeed B</p>
          </div>
        </div>
        <!-- Testimonial 5 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Making it this far was only a dream and now im living it"</p>
            <p class="author">- Sarah S</p>
          </div>
        </div>
        <!-- Testimonial 6 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Didnt expect my brand to actually grow the way it did. Thank you so much!"</p>
            <p class="author">- Yasmina D</p>
          </div>
        </div>
        <!-- Testimonial 7 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"balekon ma ken fi majel yekbar my brand. Thank you ktir."</p>
            <p class="author">- Elias Y</p>
          </div>
        </div>
        <!-- Testimonial 8 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"b2adder ktir il flexibility bel ta3amol ma3kon. shoukraaan!"</p>
            <p class="author">- Charbel K</p>
          </div>
        </div>
      </div>
      
      <div class="slidere-track">
        <!-- Testimonial 1 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Never knew this was what was missing for my brand. I'm so thankful for you guys!"</p>
            <p class="author">- Jenny R</p>
          </div>
        </div>
        <!-- Testimonial 2 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"My brand has come such a long way with your help. Thank you!"</p>
            <p class="author">- Joanna F</p>
          </div>
        </div>
        <!-- Testimonial 3 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"I never really had the time to work on digital marketing for my brand. you made it look so easy."</p>
            <p class="author">- Mariam M</p>
          </div>
        </div>
        <!-- Testimonial 4 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"you guys really took my business to the next level."</p>
            <p class="author">- Saeed B</p>
          </div>
        </div>
        <!-- Testimonial 5 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Making it this far was only a dream and now im living it"</p>
            <p class="author">- Sarah S</p>
          </div>
        </div>
        <!-- Testimonial 6 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Didnt expect my brand to actually grow the way it did. Thank you so much!"</p>
            <p class="author">- Yasmina D</p>
          </div>
        </div>
        <!-- Testimonial 7 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"balekon ma ken fi majel yekbar my brand. Thank you ktir."</p>
            <p class="author">- Elias Y</p>
          </div>
        </div>
        <!-- Testimonial 8 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"b2adder ktir il flexibility bel ta3amol ma3kon. shoukraaan!"</p>
            <p class="author">- Charbel K</p>
          </div>
        </div>
      </div>
      <div class="slidere-track">
        <!-- Testimonial 1 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Never knew this was what was missing for my brand. I'm so thankful for you guys!"</p>
            <p class="author">- Jenny R</p>
          </div>
        </div>
        <!-- Testimonial 2 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"My brand has come such a long way with your help. Thank you!"</p>
            <p class="author">- Joanna F</p>
          </div>
        </div>
        <!-- Testimonial 3 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"I never really had the time to work on digital marketing for my brand. you made it look so easy."</p>
            <p class="author">- Mariam M</p>
          </div>
        </div>
        <!-- Testimonial 4 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"you guys really took my business to the next level."</p>
            <p class="author">- Saeed B</p>
          </div>
        </div>
        <!-- Testimonial 5 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Making it this far was only a dream and now im living it"</p>
            <p class="author">- Sarah S</p>
          </div>
        </div>
        <!-- Testimonial 6 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"Didnt expect my brand to actually grow the way it did. Thank you so much!"</p>
            <p class="author">- Yasmina D</p>
          </div>
        </div>
        <!-- Testimonial 7 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"balekon ma ken fi majel yekbar my brand. Thank you ktir."</p>
            <p class="author">- Elias Y</p>
          </div>
        </div>
        <!-- Testimonial 8 -->
        <div class="wrappere">
          <div class="lid one"></div>
          <div class="lid two"></div>
          <div class="envelope"></div>
          <div class="letter">
            <p>"b2adder ktir il flexibility bel ta3amol ma3kon. shoukraaan!"</p>
            <p class="author">- Charbel K</p>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</section>

<button id="musicController" class="music-controller" aria-label="Music Controls">
  <div class="control-half volume-half">
    <i class="fas fa-volume-mute"></i>
  </div>
  <div class="control-half next-half">
    <i class="fas fa-forward"></i>
  </div>
</button>

<footer class="footer-container">
  <div class="footer-message">
      Oh Look, You've Made it<br>
      All The Way Down Here
  </div>
  <div style="text-align: center;">
      <a href="https://wa.me/96171293786?text=Hey%21" target="_blank" class="cta-button" style="margin-bottom: 5vh;">Let's Connect</a>
  </div>
  <div class="footer-bottom">
   <div class="socialf-links">
    <a href="https://www.instagram.com/deardiary.media">Instagram</a>
    <a href="https://www.facebook.com/people/Dear-Diary-Media/61572525600344/">Facebook</a>
    <a href="https://www.linkedin.com/company/dear-diary-media/">LinkedIn</a>
    <a href="https://www.tiktok.com/@deardiary.media">TikTok</a>
</div>

      <div class="copyright">
          © 2024 DearDiary
      </div>
      <div class="contact-info">
        <p><a href="https://g.co/kgs/cCJ9SnF" target="_blank">BDD, Bechara El Khoury, Beirut, Lebanon</a></p>
        <p><a href="mailto:info@deardiary.media" style=" animation: flicker 1.2s infinite alternate; color: #E2CB9F;">info@deardiary.media  </a></p>
    </div>
  </div>
</footer>
  </main>

  <!-- SCRIPTS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="./assests/js/camera.js"></script>
  <script src="./assests/js/main.js"></script>
  <script src="./assests/js/circlevideo.js"></script>
  <script src="./assests/js/cubesvideos.js"></script>
  <script src="./assests/js/secret.js"></script>
  <script src="./assests/js/beforeafter.js"></script>
  <script src="./assests/js/envelope.js"></script>
  <script src="./assests/js/dust.js"></script>
  <script src="./assests/js/lazyload.js"></script>
  <!-- Required libraries - Add these before your closing </body> tag -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get our elements
    const video = document.getElementById('scroll-video');
    const canvas = document.getElementById('video-canvas');
    const container = document.querySelector('.video-scroll-container');
    const ctx = canvas.getContext('2d');
    
    // Canvas dimensions and video status tracking
    let canvasWidth, canvasHeight;
    let videoFrames = [];
    let frameCount = 0;
    let isVideoReady = false;
    let lastScrollTop = 0;
    let lastFrameDrawn = -1;
    let ticking = false;
    
    // Set canvas size
    function resizeCanvas() {
      canvasWidth = window.innerWidth;
      canvasHeight = window.innerHeight;
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;
    }
    
    // Initialize canvas size
    resizeCanvas();
    
    // Adjust canvas on window resize
    window.addEventListener('resize', resizeCanvas);
    
    // Extract and store video frames for smoother playback
    function extractVideoFrames() {
      return new Promise(resolve => {
        // Calculate total frames (assuming 30fps)
        frameCount = Math.ceil(video.duration * 30);
        
        // Function to capture a frame
        const captureFrame = (frameIndex) => {
          return new Promise(frameResolve => {
            // Set video to exact time for this frame
            video.currentTime = frameIndex / 30;
            
            // Once video seeks to that time
            video.addEventListener('seeked', function onSeeked() {
              // Remove the event listener to prevent multiple calls
              video.removeEventListener('seeked', onSeeked);
              
              // Create an offscreen canvas to store the frame
              const offscreenCanvas = document.createElement('canvas');
              offscreenCanvas.width = video.videoWidth;
              offscreenCanvas.height = video.videoHeight;
              const offscreenCtx = offscreenCanvas.getContext('2d');
              
              // Draw the video frame to the offscreen canvas
              offscreenCtx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);
              
              // Store the frame
              videoFrames[frameIndex] = offscreenCanvas;
              
              // Resolve the promise
              frameResolve();
            }, { once: true });
          });
        };
        
        // Indicate how many frames to capture (capturing every 2nd frame is usually sufficient)
        // For a 25-second video at 30fps, this would be around 375 frames
        // Adjust the step size based on your video length and desired smoothness
        const step = 2;
        const framesToCapture = Math.ceil(frameCount / step);
        console.log(`Preparing to capture ${framesToCapture} frames...`);
        
        // Show loading state if needed
        // document.querySelector('.loading-indicator').style.display = 'block';
        
        // Capture frames sequentially
        let capturedCount = 0;
        let frameIndex = 0;
        
        function captureNextFrame() {
          if (frameIndex >= frameCount) {
            console.log('All frames captured!');
            isVideoReady = true;
            // Hide loading indicator if needed
            // document.querySelector('.loading-indicator').style.display = 'none';
            resolve();
            return;
          }
          
          captureFrame(frameIndex).then(() => {
            capturedCount++;
            if (capturedCount % 10 === 0) {
              console.log(`Captured ${capturedCount} frames...`);
            }
            frameIndex += step;
            captureNextFrame();
          });
        }
        
        captureNextFrame();
      });
    }
    
    // Draw a specific frame to the canvas
    function drawFrame(frameIndex) {
      if (frameIndex !== lastFrameDrawn && videoFrames[frameIndex]) {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        
        // Calculate aspect ratio to maintain proportions
        const videoRatio = video.videoWidth / video.videoHeight;
        const canvasRatio = canvasWidth / canvasHeight;
        
        let drawWidth, drawHeight, offsetX, offsetY;
        
        if (videoRatio > canvasRatio) {
          // Video is wider than canvas
          drawHeight = canvasHeight;
          drawWidth = drawHeight * videoRatio;
          offsetX = (canvasWidth - drawWidth) / 2;
          offsetY = 0;
        } else {
          // Video is taller than canvas
          drawWidth = canvasWidth;
          drawHeight = drawWidth / videoRatio;
          offsetX = 0;
          offsetY = (canvasHeight - drawHeight) / 2;
        }
        
        // Draw the frame
        ctx.drawImage(videoFrames[frameIndex], offsetX, offsetY, drawWidth, drawHeight);
        lastFrameDrawn = frameIndex;
      }
    }
    
    // Handle scroll events
    function handleScroll() {
      if (!ticking && isVideoReady) {
        window.requestAnimationFrame(() => {
          // Calculate scroll progress
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          const containerRect = container.getBoundingClientRect();
          const containerTop = containerRect.top + scrollTop;
          const scrollPosition = scrollTop - containerTop;
          const scrollHeight = container.offsetHeight - window.innerHeight;
          const scrollProgress = Math.max(0, Math.min(1, scrollPosition / scrollHeight));
          
          // Find the closest pre-rendered frame
          const step = 2; // Same step as used in extractVideoFrames
          const frameIndex = Math.round(scrollProgress * (frameCount - 1) / step) * step;
          
          // Draw the frame
          drawFrame(frameIndex);
          
          ticking = false;
        });
        
        ticking = true;
      }
    }
    
    // Initialize once video is loaded
    video.addEventListener('loadedmetadata', function() {
      console.log('Video metadata loaded. Duration:', video.duration);
      
      // Adjust container height based on video duration if needed
      // For a 25-second video, 300vh is usually good, but you can adjust
      const scrollHeight = Math.max(300, video.duration * 12);
      container.style.height = `${scrollHeight}vh`;
      
      // Extract frames for smoother playback
      extractVideoFrames().then(() => {
        console.log('Frames extracted, scroll control ready');
        
        // Draw initial frame
        drawFrame(0);
        
        // Add scroll event listener
        window.addEventListener('scroll', handleScroll, { passive: true });
        
        // Initial scroll position check
        handleScroll();
      });
    });
    
    // Pre-load the video
    if (video.readyState >= 2) {
      video.dispatchEvent(new Event('loadedmetadata'));
    }
  });
  </script>
    
 

</body>
</html>
